import{m as A,k as v,t as k,c as E,j as e,x,U as N,f,r as u,B as h,g as S,H as m,J as g,_ as M,w as U,L as H}from"./index-BMh66HCr.js";import{c as p}from"./clsx-B-dksMZM.js";import{u as C}from"./index.esm-ClWcd2Qo.js";/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=A("SendHorizontal",[["path",{d:"m3 3 3 9-3 9 19-9Z",key:"1aobqy"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),_=({userId:c})=>{const{data:s}=k({queryKey:["user",c],queryFn:async()=>{const{data:l}=await E.get(`/api/user/${c}`);return l.user}});return e.jsxs("div",{className:"flex gap-3 px-5 py-1 border-b-2",children:[e.jsx("div",{className:"w-11 h-11 rounded-full overflow-hidden",children:e.jsx("img",{src:(s==null?void 0:s.picture)||"./person.jpg",className:"w-full h-full object-cover",alt:""})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s==null?void 0:s.name}),e.jsx("h3",{className:"text-xs",children:s==null?void 0:s.role})]})]})};_.propTypes={userId:v.string};const P=()=>{const[c]=x(),s=c.get("chatId"),l=c.get("userId"),{user:a}=N(),n=f(),o=u.useRef(null);u.useEffect(()=>{const r=i=>{s==i.message.chat&&n({type:m.UPDATE_MESSAGES,payload:i.message}),n({type:g.UPDATE_CHATS,payload:i.message.chat})};return h.on("msg-receive",r),()=>{h.off("msg-receive",r)}},[s,n]);const d=S(r=>r.messages);return u.useEffect(()=>{n({type:m.FETCH_MESSAGES_REQUEST,payload:{chatId:s,limit:10}})},[n,s]),u.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[d]),e.jsxs("div",{className:"lg:max-h-[calc(100svh-48px)] overflow-auto",ref:o,children:[e.jsx(_,{userId:l}),e.jsx("div",{className:"px-5 py-2",children:d.data&&e.jsx("div",{className:"space-y-2",children:d.data.map(r=>e.jsx("div",{className:p("w-full flex",{"justify-end":(a==null?void 0:a._id)===r.sender}),children:e.jsx("div",{className:p("px-4 py-2  max-w-64 rounded-full",{"bg-blue-500 text-white-White":(a==null?void 0:a._id)!==r.sender},{"bg-blue-100":(a==null?void 0:a._id)===r.sender}),children:r.text})},r._id))})})]})},R=()=>{const{register:c,handleSubmit:s,reset:l}=C(),[a,n]=u.useState(!1),[o]=x(),d=o.get("userId"),r=o.get("role"),{user:i}=N(),j=f(),I=s(async T=>{var y,b;try{n(!0);const{data:t}=await E.post(`/api/message/${d}/${r}`,{text:T.message});console.log(t),t.chat?h.emit("send-msg",{senderId:i._id,receiverId:d,message:t.message,chat:t.chat}):h.emit("send-msg",{senderId:i._id,receiverId:d,message:t.message}),j({type:m.UPDATE_MESSAGES,payload:t.message}),j({type:g.UPDATE_CHATS,payload:t.message.chat}),l(),n(!1)}catch(t){M.error(((b=(y=t==null?void 0:t.response)==null?void 0:y.data)==null?void 0:b.message)||"There is an Error"),n(!1),console.error(t)}});return e.jsx("form",{onSubmit:I,children:e.jsxs("div",{className:"flex items-center gap-3 border-t-2",children:[e.jsx("input",{...c("message",{required:!0}),type:"text",className:"w-full outline-none border-black-black/20 px-3 py-3",placeholder:"Enter your message"}),e.jsx("button",{disabled:a,className:"",children:e.jsx($,{})})]})})},w=({userId:c})=>{const s=S(a=>a.chats),{pathname:l}=U();return e.jsxs("div",{className:"border-l",children:[e.jsx("div",{className:"border-b py-3 px-2",children:e.jsx("h1",{className:"text-xl font-bold",children:"Chats:"})}),e.jsx("div",{className:"w-72 ",children:s.data?s.data.map(a=>e.jsx(H,{to:`${l}?userId=${a.user._id}&chatId=${a._id}&role=${a.user.role}`,className:p("block p-2 border-b-2",{"bg-blue-500 text-white-White":a.user._id==c}),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden border border-black-black/5 bg-black-black/20",children:e.jsx("img",{className:"w-full h-full object-cover",src:a.user.picture||"../person.jpg",alt:""})}),e.jsx("div",{className:"-space-y-4",children:e.jsx("h6",{className:"font-medium",children:a.user.name})})]})},a._id)):""})]})};w.propTypes={userId:v.string};const q=()=>{const[c]=x(),s=f(),l=c.get("userId");return u.useEffect(()=>{s({type:g.FETCH_MESSAGES_REQUEST})},[s]),e.jsxs("div",{className:"flex h-[calc(100svh-64px)] lg:h-[calc(100svh-1px)] border-t",children:[e.jsx("div",{className:"flex-1 h-[calc(100svh-64px)] overflow-auto lg:h-[calc(100svh-1px)] flex flex-col justify-between",children:l?e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(R,{})]}):e.jsx("div",{className:"w-full h-full flex justify-center items-center",children:"Select Chat"})}),e.jsx(w,{userId:l})]})};export{q as default};
